import { NextRequest, NextResponse } from "next/server";/** * Get ETag version from request headers * @param req - The NextRequest object * @returns The version number or null if invalid */export function getETagVersion(req: NextRequest): number | null {  const ifMatch = req.headers.get("if-match");  if (!ifMatch) return null;  const version = Number(ifMatch.replace(/"/g, "").trim());  return Number.isFinite(version) ? version : null;}/** * Set ETag header on response * @param response - The NextResponse object * @param version - The version number to set * @returns The modified response */export function setETagHeader(response: NextResponse, version: number): NextResponse {  response.headers.set("ETag", `"${version}"`);  return response;}/** * Check if ETag is required and valid * Returns error response if missing or invalid, null if valid * @param req - The NextRequest object * @returns Error response or null */export function checkETagRequired(req: NextRequest): NextResponse | null {  const ifMatch = req.headers.get("if-match");  if (!ifMatch) {    return NextResponse.json({ message: "ETag required" }, { status: 412 });  }  const version = Number(ifMatch.replace(/"/g, "").trim());  if (!Number.isFinite(version)) {    return NextResponse.json({ message: "Invalid Etag" }, { status: 400 });  }  return null; // no error}/** * Validate ETag and get version (combined check + get) * @param req - The NextRequest object * @returns { valid: true, version: number } or { valid: false, response: NextResponse } */export function validateETag(req: NextRequest):   | { valid: true; version: number }  | { valid: false; response: NextResponse } {  const ifMatch = req.headers.get("if-match");    if (!ifMatch) {    return {      valid: false,      response: NextResponse.json({ message: "Erreur dans le etag" }, { status: 412 })    };  }    const version = Number(ifMatch.replace(/"/g, "").trim());    if (!Number.isFinite(version)) {    return {      valid: false,      response: NextResponse.json({ message: "Invalid Etag" }, { status: 400 })    };  }    return { valid: true, version };}